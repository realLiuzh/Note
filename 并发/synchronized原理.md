# synchronized原理

JVM基于**获取和释放Monitor对象的所有权**来实现方法同步和代码块同步。

你要知道，任何一个对象都与一个monitor(C++实现)关联。当一个monitor被持有时，它所对应的对象处于锁定状态。

具体细节是在编译后：

- 把monitorenter指令插入到同步代码块的开始位置。
- 把monitorexit指令插入到同步代码块结束位置和异常处。

当线程执行到monitorenter指令时，会尝试获取对象所对应的monitor。如果锁的计数器为0表示锁可以获取，获取后将锁的计数器设为1.

拥有锁的线程执行monitorexit来释放锁。执行指令之后，锁的计数器设为0。表示其它线程可以尝试获取锁。

> syn修饰的方法其实使用的是`ACC_SYNCHRONIZED` 标识，该标识指明了该方法是一个同步方法。
>
> 不过本质也是获取monitor对象的所有权。

