# 对象分配过程

在探讨对象分配过程中，我们重点还要关注GC的时机。

GC应该保证以下准则：**不到万不得已的时候不会GC。**因为频繁GC会影响效率。

接下来看对象分配的过程。

1. 首先，新建的对象被分配到新生代的伊甸园区。
2. 如果此时伊甸园区内存不足的话，会触发Minor GC（3）。当然了，如果足够的整个对象分配过程就到此结束了。
3. Minor GC会使用标记-复制算法把伊甸园区和幸存0区中存活的对象复制到幸存1区。Minor GC之后，如果伊甸园区可以放下对象就为其分配内存。否则就被认为是超大对象直接放到老年代。
4. 如果老年代一开始就可以放下的话就为其分配内存。否则老年代会使用标记整理算法进行Major GC。如果Major之后可以放下就会为其分配内存。
5. 否则的话就会报出OOM异常。

有点绕，总结一下：

- 新建的这个对象有可能放在新生代的伊甸园区，也有可能放在老年代。
- 放在伊甸园区可能是在Minor GC之前或者之后。之前或者之后取决于一开始伊甸园区是否可以容下该对象。
- 放在老年代也可能是在Major GC之前或者之后。之前或者之后取决于一开始老年代区是否可以容下该对象。
- 我们可以发现，JVM首先会试着存放该对象，如果放的下就皆大欢喜。否则就进行Minor/Major GC后皆大欢喜。这里我们也可以看到上面说的 **万不得已**，它会先去尝试。
- Minor/Major GC后也不一定皆大欢喜。如果Minor GC失败了就尝试把该对象放到老年代。如果Major GC失败了的话就gg(OOM)了。
- 一个对象只有在新生代和老年代都放不下的时候才会gg。

