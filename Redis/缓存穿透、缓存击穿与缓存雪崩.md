# 缓存穿透、缓存击穿与缓存雪崩

Reids在作为缓存时会出现缓存穿透、缓存击穿与缓存雪崩三种问题。

检测缓存问题的方法就是统计总调用次数，缓存命中次数和后端存储命中次数。如果后端存储命中次数过大就说明出现了缓存问题。

# 缓存穿透

缓存穿透是指查询一个根本不存在的数据，这样就会导致请求不会命中缓存而是去查询数据库，导致后端存储压力增大，缓存失去了保护后端存储的功能。

导致缓存穿透的原因有两个，一个是自身代码和数据有问题。还有可能就是恶意攻击者导致大量空命中。

解决缓存穿透的方法有两种：

**1、缓存空对象**

将空对象缓存到Redis中。这样再次收到同样查询不存在的数据时就可以保护后端存储了。

但是这种方法会占用大量的内存（键），可以对这些键设置过期时间。

**2、布隆过滤器**

在缓存层之前加上布隆过滤器作为第一层进行过滤。布隆过滤器可以判断出该数据是否一定不存在。

如果布隆过滤器认为该数据一定不存在，那么直接返回，不需要访问缓存和后端存储。



# 缓存击穿

缓存击穿是指某个热点key过期但是重建热点key的过程比较繁琐所以重建周期较长，最后导致请求都去访问后端存储，数据库压力过大。

解决方法有两种，一是热点key永不过期；二是使用互斥锁保证只有一个线程/请求去重建热点key，其它请求等待热点key的重建。

# 缓存雪崩

缓存雪崩是指由于某些原因导致缓存层不可用，请求全部命中在后端存储上，导致后端存储压力过大。

导致缓存雪崩的原因有两个。一是大部分key同时过期；二是Redis不可用。

解决Redis不可用的方法就是搭建集群，保证缓存层的高可用。

解决大部分key同时过期的方法有两种，一是随机初始过期时间，二是使用限流操作来保护后端存储。

