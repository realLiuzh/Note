# HTTPS

# 1、HTTP与HTTPS的区别

1、安全性

2、SSL/TLS建立连接

3、端口

4、证书

# 2、HTTPS原理

https://juejin.cn/post/6844903892765900814

(感觉小林那个讲的很模糊，现在重新梳理一遍)

HTTP存在的问题有两个：第一就是数据明文传输，第二就是存在中间人攻击。

## 2.1、混合加密

解决明文传输的方法是混合加密。

客户端随机生成一个密钥，通过服务器的公钥加密后发送给服务端。服务端使用私钥解密获得密钥。此过程为非对称加密。保证了密钥不被窃取。

在传输数据时，通信双方均通过密钥进行对称加密。

这样做的目的是对称加密的速度更快。

## 2.2、中间人攻击

我们明白了混合加密是先用服务端的公钥加密密钥，但是这个服务端的公钥哪来的呢？

A:连接一开始服务端就把自己的公钥发送给客户端。

但是这个时候，有可能有个中间人截取了服务端的公钥，并将其替换为自己的公钥发送给客户端。客户端在发送密钥时，使用的是中间人的公钥。中间人截取了客户端发送的加密数据后，可以用自己的私钥解密。造成了消息泄露。

![img](https://cdn.nlark.com/yuque/0/2022/webp/2388408/1662692499298-c35a5f11-0fe7-4ea9-bb4f-819b81610ba6.webp)

产生这个问题的根本原因就是：**客户端无法确认公钥的合法性！**

## 2.3、数字证书

数字证书的内容：服务端公钥+数字签名。数字签名是由公钥通过哈希算法生产摘要，再由CA（证书的颁发机构）的私钥加密得到的。

![img](https://cdn.nlark.com/yuque/0/2022/webp/2388408/1662692635287-f8754bb2-0722-4bc3-918a-6b89138bea37.webp)

## 2.4、如何校验数字证书？

将公钥进行哈希后的结果与使用CA公钥解密后的数字签名作对比。如果相同那么就说明合法。

![img](https://cdn.nlark.com/yuque/0/2022/png/2388408/1662692740046-3b48c8d2-4f8c-4672-a06d-311057441e28.png)

## 2.5、SSL/TLS握手

1. 客户端向服务端发送支持的SSL/TLS版本号以及支持的加密方法，和一个客户端生成的随机数
2. 服务端确认版本的加密方法，向客户端发送数字证书以及服务端生产的随机数
3. 客户端验证数字证书的合法性。验证无误后取出公钥，生成一个随机数，用公钥加密这个随机数，发送给服务端。
4. 服务端用私钥解密获取随机数
5. 此时客户端和服务端都拥有三个随机数，此时它们就用约定好的加密算法加密三个随机数来生产对话密钥。此后的数据传输都使用这个对话密钥。