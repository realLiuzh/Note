# TCP基础知识

## TCP的报文格式

![img](https://cdn.nlark.com/yuque/0/2022/png/2388408/1661999285071-db2d4e75-afc3-498b-9a5b-7aa8bd3a772b.png)

序列号和确认号的作用是保证TCP的可靠传输

ACK为1时，确认应答号才有效。RST、SYN和FIN标志位都用于TCP连接的建立与销毁

窗口大小是用来进程流量控制的，接收方通过向窗口大小中填入值可以控制发送方的发送速率

另外，TCP首部最小是20字节，因为有选项字段。

## TCP的特点

1.面向连接的

tcp在发送数据之前需要进行握手操作来交换一些信息，来保证可靠传输

2.可靠的

tcp保证接收方接受的报文是有序的、无丢失、无冗余和无差错的。

3.面向字节流

tcp不像udp那样一个包一个包的发送，而是是以流的形式发送。所以接收方应该明确包的边界，否则无法接收到正确的信息。

如何理解tcp面向字节流、udp面向报文段

面向字节流和面向报文段的区别在于：用户读数据的时候，是不是有边界。

没有边界：也就是我这次read，不知道是读了几个tcp报文段，可能是1个、2个、2.5个....，因此需要**上层协议按照自己的边界**来划分。

有边界：每次read到的一定是一个数据包，即使这个数据包太大没读完，那么下一次读也是一个新的数据包。



如何解决粘包？

粘包：两个数据的部分内容放到同一个tcp包中。

1.固定消息长度

不灵活，基本不用

2.特殊字符作为边界

在两个消息之间插入特殊字符，当接收方读到特殊字符就意味着读完了一个完整的消息。

HTTP的解决方法就是特殊字符作为边界：

请求行\r\n

请求头\r\n

\r\n

数据

至此，可以通过“\r\n”来分割http的三部分内容。数据的长度是用"content-length"长度确定。

3.自定义消息格式

## TCP和UDP的区别

1.有无连接

2.是否可靠

3.面向字节流和面向报文段

4.是否可以一对多

5.拥塞控制与流量控制

6.分片

7.首部开销

![img](https://cdn.nlark.com/yuque/0/2022/png/2388408/1662127859083-6b8393bb-e2b9-41e4-b570-9eb983261e7d.png)

https://zhuanlan.zhihu.com/p/78084602

## TCP和UDP的应用场景

TCP可靠：网页，文件下载

UDP快捷：视频通话